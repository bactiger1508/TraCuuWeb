@model List<TraCuuWeb.Data.GoiCuoc>
@using TraCuuWeb.Data
@{
    ViewData["Title"] = "Home";
    var nhomLons = ViewBag.NhomLons as List<NhomLon>;
    int currentCategory = ViewBag.CurrentCategory ?? 0;
    int currentPage = ViewBag.CurrentPage ?? 1;
    int totalPages = ViewBag.TotalPages ?? 1;

    List<int?> GetPaging(int current, int total)
    {
        var pages = new List<int?>();

        if (total <= 5)
        {
            for (int i = 1; i <= total; i++) pages.Add(i);
        }
        else
        {
            pages.Add(1);

            if (current > 3)
            {
                pages.Add(null); // dấu ...
            }

            for (int i = current - 1; i <= current + 1; i++)
            {
                if (i > 1 && i < total)
                {
                    pages.Add(i);
                }
            }

            if (current < total - 2)
            {
                pages.Add(null); // dấu ...
            }

            pages.Add(total);
        }

        return pages;
    }

    var paging = GetPaging(currentPage, totalPages);
}
<!-- Hero Start -->
<div class="container-fluid py-5 mb-5 hero-header">
    <div class="container py-5">
        <div class="row g-5 align-items-center">
            <div class="col-md-12 col-lg-4 order-2 order-lg-1 d-flex flex-column align-items-start justify-content-center" style="height: 310px; min-height: 310px;">
                <div class="d-flex flex-column justify-content-center h-100 w-100">
                    <h4 class="mb-2 text-secondary" style="font-size: 1.2rem;">Dịch vụ viễn thông VNPT</h4>
                    <h1 class="mb-4 display-5 text-primary" style="font-size: 2.5rem; font-weight: bold;">Đăng ký các gói cước mới nhất</h1>
                    <div class="position-relative w-100" style="max-width: 400px;">
                        <input class="form-control border-2 border-secondary w-100 py-3 px-4 rounded-pill" type="text" placeholder="Tìm kiếm gói cước...">
                        <button type="submit" class="btn btn-success border-2 border-secondary py-3 px-4 position-absolute rounded-pill text-white h-100" style="top: 0; right: 0;">Tìm kiếm</button>
                    </div>
                </div>
            </div>
            <div class="col-md-12 col-lg-8 order-1 order-lg-2 d-flex align-items-center">
                <div class="w-100 d-flex justify-content-center">
                    <div id="posterCarousel" class="carousel slide w-100" data-bs-ride="carousel" data-bs-interval="2000" style="height: 310px;">
                        <div class="carousel-inner rounded shadow">
                            <div class="carousel-item active">
                                <img src="~/img/poster1.jpg" class="img-fluid rounded d-block mx-auto" alt="Poster 1" style="height: 310px; width: 100%; object-fit: cover; background: #f8f9fa;">
                            </div>
                            <div class="carousel-item">
                                <img src="~/img/poster2.jpg" class="img-fluid rounded d-block mx-auto" alt="Poster 2" style="height: 310px; width: 100%; object-fit: cover; background: #f8f9fa;">
                            </div>
                            <div class="carousel-item">
                                <img src="~/img/poster3.jpg" class="img-fluid rounded d-block mx-auto" alt="Poster 3" style="height: 310px; width: 100%; object-fit: cover; background: #f8f9fa;">
                            </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#posterCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#posterCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Hero End -->
<!-- Featurs Section -->
<div class="container-fluid featurs py-5">
    <div class="container py-5">
        <div class="row g-4">
            @{
                var featurs = new[] {
                        new { Icon = "fa-wifi", Text = "Lắp đặt nhanh" },
                        new { Icon = "fa-headset", Text = "Hỗ trợ 24/7" },
                        new { Icon = "fa-shield-alt", Text = "Bảo mật & ổn định" },
                        new { Icon = "fa-money-bill-wave", Text = "Giá tốt, nhiều ưu đãi" }
                        };
            }
            @foreach (var item in featurs)
            {
                <div class="col-md-6 col-lg-3">
                    <div class="featurs-item text-center rounded bg-light p-4">
                        <div class="featurs-icon btn-square rounded-circle bg-warning mb-5 mx-auto">
                            <i class="fas @item.Icon fa-3x text-white"></i>
                        </div>
                        <div class="featurs-content text-center">
                            <h5>@item.Text</h5>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
<!-- Featurs Section End -->
<!-- Gói cước của chúng tôi -->
<div class="container py-5">
    <div class="mb-4">
        <h1 class="section-title">Gói cước của chúng tôi</h1>
        <div class="d-flex flex-wrap gap-2 justify-content-end mt-3 mb-4">
            <a href="@Url.Action("Index", new { categoryId = 0 })" class="btn btn-outline-warning @(currentCategory == 0 ? "active" : "")">Tất cả</a>
            @if (nhomLons != null)
            {
                foreach (var nhom in nhomLons)
                {
                    <a href="@Url.Action("Index", new { categoryId = nhom.Id })" class="btn btn-outline-warning @(currentCategory == nhom.Id ? "active" : "")">@nhom.TenNhomLon</a>
                }
            }
        </div>
    </div>
    <div class="row g-4 justify-content-center">
        @foreach (var goi in Model)
        {
            <div class="col-md-6 col-lg-4 col-xl-3 d-flex">
                <div class="rounded position-relative fruite-item goicuoc-equal-box w-100" style="border: 2px solid #f7b731;">
                    <div class="fruite-img">
                        <img src="@(string.IsNullOrEmpty(goi.HinhAnh) ? Url.Content("~/img/fruite-item-1.jpg") : goi.HinhAnh)" class="img-fluid w-100 rounded-top goicuoc-equal-img" alt="@goi.TenGoi">
                    </div>
                    <div class="text-white bg-warning px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px; font-weight:bold;">Gói cước mới</div>
                    <div class="p-4 border border-secondary border-top-0 rounded-bottom d-flex flex-column flex-grow-1">
                        <h4>@goi.TenGoi</h4>
                        <div class="goicuoc-desc">@goi.NoiDung</div>
                        <div class="goicuoc-bottom">
                            <p class="text-dark fs-5 fw-bold mb-0">
                                @if (goi.GiaCuocs.Any())
                                {
                                    @(goi.GiaCuocs.First().Gia + " VNĐ")
                                }
                                else
                                {
                                    <span>Liên hệ</span>
                                }
                            </p>
                            <a href="#" class="btn border border-warning rounded-pill px-3 text-warning"><i class="fa fa-shopping-bag me-2 text-warning"></i> Đăng ký ngay</a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Pagination -->
    <nav class="pagination-main d-flex justify-content-center mt-4">
        <ul class="pagination flex-row">
            <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                <a class="page-link" href="@Url.Action("Index", new { categoryId = currentCategory, page = 1 })">&laquo;&laquo;</a>
            </li>
            <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                <a class="page-link" href="@Url.Action("Index", new { categoryId = currentCategory, page = currentPage - 1 })">&laquo;</a>
            </li>
            @foreach (var p in paging)
            {
                if (p == null)
                {
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                }
                else
                {
                    <li class="page-item @(p == currentPage ? "active" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { categoryId = currentCategory, page = p })">@p</a>
                    </li>
                }
            }
            <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                <a class="page-link" href="@Url.Action("Index", new { categoryId = currentCategory, page = currentPage + 1 })">&raquo;</a>
            </li>
            <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                <a class="page-link" href="@Url.Action("Index", new { categoryId = currentCategory, page = totalPages })">&raquo;&raquo;</a>
            </li>
        </ul>
    </nav>
</div>

<!-- Các gói cước mới nhất -->
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="section-title">Các gói cước mới nhất</h1>
    </div>
    <div class="row g-4 justify-content-center">
        @foreach (var goi in Model.Take(8))
        {
            <div class="col-md-6 col-lg-4 col-xl-3 d-flex">
                <div class="rounded position-relative fruite-item goicuoc-equal-box w-100" style="border: 2px solid #f7b731;">
                    <div class="fruite-img">
                        <img src="@(string.IsNullOrEmpty(goi.HinhAnh) ? Url.Content("~/img/fruite-item-1.jpg") : goi.HinhAnh)" class="img-fluid w-100 rounded-top goicuoc-equal-img" alt="@goi.TenGoi">
                    </div>
                    <div class="text-white bg-warning px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px; font-weight:bold;">Gói cước mới</div>
                    <div class="p-4 border border-secondary border-top-0 rounded-bottom d-flex flex-column flex-grow-1">
                        <h4>@goi.TenGoi</h4>
                        <div class="goicuoc-desc">@goi.NoiDung</div>
                        <div class="goicuoc-bottom">
                            <p class="text-dark fs-5 fw-bold mb-0">
                                @if (goi.GiaCuocs.Any())
                                {
                                    @(goi.GiaCuocs.First().Gia + " VNĐ")
                                }
                                else
                                {
                                    <span>Liên hệ</span>
                                }
                            </p>
                            <a href="#" class="btn border border-warning rounded-pill px-3 text-warning"><i class="fa fa-shopping-bag me-2 text-warning"></i> Đăng ký ngay</a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<style>
    .goicuoc-equal-box {
        display: flex;
        flex-direction: column;
        height: 100%;
        min-height: 350px;
        justify-content: space-between;
    }

    .goicuoc-equal-img {
        height: 160px;
        object-fit: cover;
        width: 100%;
    }

    .goicuoc-desc {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        min-height: 48px;
        max-height: 48px;
        margin-bottom: 0.5rem;
        color: #555;
        font-size: 15px;
    }

    .goicuoc-bottom {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto;
    }
</style>
